<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <title>Document</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      /* transition: 0.3s; */
    }

    body {
      background: url('./images/bg.png') no-repeat center 120%/cover;
      width: 95vw;
      height: 100vh;
      margin: auto;
      font-family: 'Noto Sans TC', sans-serif;
      overflow: hidden;
    }


    #area {
      width: 700px;
      height: 400px;
      background: #000;
      position: absolute;
      left: 50%;
      top: 50%;
      overflow: hidden;
      background: #000;
      transform: translate(-50%, -50%);
    }

    #area img {
      height: 100px;
      position: absolute;
      user-select: none;
      /* 設定無法選取圖片 */
      -webkit-user-select: none;
      -webkit-user-drag: none;
    }

    #btnStart {
      font-size: 30px;
      position: absolute;
      left: 50%;
      top: 30%;
      transform: translate(-50%, -50%);
      padding: 0.2rem 0.5rem;
      background: rgb(149, 203, 154);
      cursor: pointer;
    }

    #btnStart:hover {
      background: rgb(184, 206, 186);
    }

    #left {
      width: 500px;
      display: flex;
      flex-wrap: wrap;
      color: #fff;
      float: left;
    }

    .theme {
      width: 100px;
      height: 150px;
      border-radius: 10px;
      border: 1px solid #333;
      text-align: center;
      margin: 5px;
      box-sizing: border-box;
    }

    #left .theme:hover {
      box-shadow: 0px 0px 10px #000;
      cursor: pointer;
    }

    .theme img {
      width: 100px;
    }

    .theme p {
      width: 60px;
      font-size: 14px;
      background: #000;
      margin: auto;
    }

    #right {
      width: 300px;
      color: #fff;
      float: right;
      text-align: center;
    }

    /* 右邊選定主題 */
    #right .theme {
      display: inline-block;
    }

    /* 重選 */
    #right .again {
      margin: 10px auto 0;
      width: 50px;
      clear: both;
      color: #000;
      background: #fff;
      cursor: pointer;
    }

    #roleNum {
      width: 700px;
      margin: auto;
      display: flex;
      opacity: 0;
      justify-content: space-around;
      flex-wrap: wrap;
      align-items: center;
      color: #fff;
    }

    .role {
      text-align: center;
      /* width: 50%; */
    }

    .role img {
      width: 50px;
    }

    #text,
    #high {
      display: none;
    }
  </style>
</head>

<body>
  <p>
    遊戲說明

    從 BT21 的角色中選擇 2 位做為遊戲的主角，遊戲畫面上方會顯示選擇的角色及對應的設定數
    ，限時 20 秒內需達到指定的目標點擊數，成功則遊戲通關，否則遊戲失敗！

    計分方式

    成功點擊畫面中任一角色可獲得 1 分，以累計分數高低作為依據。
    ※ 分數最高，但沒有達到目標點擊數的玩家是無法列入排行的

    想成為一流的點擊王嗎？準備好了就開始遊戲吧！
  </p>
  <input type="button" id="btnStart" value="開始">
  <div id="roleNum">
    <div class="role">
      <img src="./images/chimmy1.png" alt="">
      <p>角色 1</p>
      <span id="text-role1">0 / 0</span>
    </div>
    <div class="role">
      <img src="./images/van1.png" alt="">
      <p>角色 2</p>
      <span id="text-role2">0 / 0</span>
    </div>
    <div id="text">
      <p>| 剩餘 | <span id="text-time">0</span> 秒</p>
      <p>| 得分 | <span id="text-score">0</span> 分</p>
    </div>
  </div>
  <div id="high">
    <p>| 紀錄者 | <span id="text-highname">0</span></p>
    <p>| 最高分 | <span id="text-highscore">0</span> 分</p>
  </div>
  <div class="container">
    <div id="left">
      <div class="theme" style="background:#fccc00">
        <img src="./images/chimmy1.png" data-title="chimmy">
        <p>CHIMMY</p>
      </div>
      <div class="theme" style="background:rgb(236, 122, 173)">
        <img src="./images/cooky1.png" data-title="cooky">
        <p>COOKY</p>
      </div>
      <div class="theme" style="background:#54C3F1">
        <img src="./images/koya1.png" data-title="koya">
        <p>KOYA</p>
      </div>
      <div class="theme" style="background:#BBA4CE">
        <img src="./images/mang1.png" data-title="mang">
        <p>MANG</p>
      </div>
      <div class="theme" style="background:#E72D30">
        <img src="./images/rj1.png" data-title="rj">
        <p>RJ</p>
      </div>
      <div class="theme" style="background:#F6AC01">
        <img src="./images/shooky1.png" data-title="shooky">
        <p>SHOOKY</p>
      </div>
      <div class="theme" style="background:#E2E2E2">
        <img src="./images/van1.png" data-title="van">
        <p>VAN</p>
      </div>
      <div class="theme" style="background:#5A77BB">
        <img src="./images/tata1.png" data-title="tata">
        <p>TATA</p>
      </div>
    </div>
    <div id="right">
      <div class="theme">
        <img src="./images/none.png">
        <p>?</p>
      </div>
      <div class="theme">
        <img src="./images/none.png">
        <p>?</p>
      </div>
      <p class="again">重選</p>
    </div>
  </div>
  <div id="area"></div>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js'
    integrity='sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=='
    crossorigin='anonymous'></script>
  <script>
    let timer = 0
    // 倒數
    let countdown = 0
    // 選擇角色點擊次數
    let click = 0
    // 角色檔名
    let role1 = '', role2 = ''
    // 分數
    let role1Score = 0, role2Score = 0, totalScore = 0
    let role1Num = Math.round(Math.random() * 15)
    let role2Num = Math.round(Math.random() * 15)

    const highscore = localStorage.btgame ? JSON.parse(localStorage.btgame) : { name: '', score: 0 }
    $('#text-highscore').text(highscore.score)
    $('#text-highname').text(highscore.name)
    $('#area').hide()
    // 選定正負角色
    $('#left .theme').each(function () {
      $(this).on('click', function () {
        click++
        if (click === 1) {
          $(this).css('border', '5px solid lightgray')
          $('.role').eq(0).find('img').attr('src', $(this).find('img').attr('src'))
          $('.role').eq(0).find('p').text($(this).find('p').text())
          $('#right .theme').eq(0).find('img').attr('src', $(this).find('img').attr('src'))
          $('#right .theme').eq(0).find('img').attr('data-title', $(this).find('img').attr('data-title'))
          $('#right .theme').eq(0).find('p').text($(this).find('p').text())
          $('#right .theme').eq(0).css('background', $(this).css('background'))
          role1 = $('#right .theme').find('img').eq(0).attr('data-title')
        } else if (click === 2) {
          $(this).css('border', '5px solid lightgray')
          $('.role').eq(1).find('img').attr('src', $(this).find('img').attr('src'))
          $('.role').eq(1).find('p').text($(this).find('p').text())
          $('#right .theme').eq(1).find('img').attr('src', $(this).find('img').attr('src'))
          $('#right .theme').eq(1).find('p').text($(this).find('p').text())
          $('#right .theme').eq(1).find('img').attr('data-title', $(this).find('img').attr('data-title'))
          $('#right .theme').eq(1).css('background', $(this).css('background'))
          role2 = $('#right .theme').find('img').eq(1).attr('data-title')
        }
      })
    })
    // 重選復原
    $('.again').on('click', function () {
      click = 0
      $('#right .theme').find('img').attr('src', './images/none.png')
      $('#right .theme').find('p').text('?')
      $('#right .theme').find('img').attr('data-title', '')
      $('#right .theme').css('background', '')
      $('#left .theme').css('border', '1px solid #333')
    })

    // ------------------------------- function -------------------------------
    // 主要移動
    function move(first) {
      const top = Math.round(Math.random() * 100) + '%'
      const left = Math.round(Math.random() * 100) + '%'
      first.stop().animate({ top, left }, 2000, function () {
        if ($('#btnStart').attr('disabled') === 'disable') move(first)
      })
      setTimeout(() => {
        first.fadeOut(400)
      }, 500);
    }
    // 次要移動
    function move(second) {
      const top = Math.round(Math.random() * 100) + '%'
      const left = Math.round(Math.random() * 100) + '%'
      second.stop().animate({ top, left }, 1000, function () {
        if ($('#btnStart').attr('disabled') === 'disable') move(second)
      })
      setTimeout(() => {
        second.fadeOut(300)
      }, 2500);
    }
    // ------------------------------- 開始遊戲 -------------------------------
    $('#btnStart').click(function () {
      score = 0
      countdown = 20
      $('#right, #left').fadeOut()
      $('#text-score').text(totalScore)
      $('#text-time').text(countdown)
      $('#text-role1').text(`${role1Score} / ${role1Num}`)
      $('#text-role2').text(`${role2Score} / ${role2Num}`)
      $('#area, #text, #high').fadeIn()
      $('#roleNum').css('opacity', 1)
      // 過關點擊要求數

      timer = setInterval(() => {
        countdown--
        $('#text-time').text(countdown)
        // 角色 1
        let top = Math.round(Math.random() * 100) + '%'
        let left = Math.round(Math.random() * 100) + '%'
        const first = $(`<img src="./images/${role1}1.png" class="one" data-title="${role1}" style="top: ${top}; left: ${left}">`)
        $('#area').append(first)
        move(first)
        // 角色 2
        setTimeout(() => {
          top = Math.round(Math.random() * 100) + '%'
          left = Math.round(Math.random() * 100) + '%'
          const second = $(`<img src="./images/${role2}1.png" class="one" data-title="${role2}" style="top: ${top}; left: ${left}">`)
          $('#area').append(second)
          move(second)
        }, 500);

        // ------------------------------- 時間停止 -------------------------------
        if (countdown === 0) {
          clearInterval(timer)
          $('#area img').remove()
          $('#area, #text, #high').fadeOut()
          if (role1Score >= role1Num && role2Score >= role2Num) alert('通關')
          else alert('GG')
          Swal.fire({
            icon: 'info',
            title: '時間到',
            text: `你的分數是 ${score} 分`
          }).then(result => {
            location.reload()
          })
          // 破紀錄時
          if (score > highscore.score) {
            Swal.fire({
              icon: 'warning',
              title: '新紀錄！',
              text: '留下大名！',
              input: 'text',
              inputPlaceholder: 'your name',
              inputAttributes: {
                reqired: true
              },
              validationMessage: '必填'
            }).then(result => {
              highscore.name = result.value
              highscore.score = score
              $('#text-highname').text(highscore.name)
              $('#text-highscore').text(highscore.score)
              localStorage.btgame = JSON.stringify(highscore)
              location.reload()
            })
          }
        }
      }, 1000);
    })

    $('#area').on('click', '.one', function () {
      $(this).stop()
      $(this).attr('src', `./images/${$(this).attr('data-title')}2.png`)
      $(this).fadeOut()
      $(this).removeClass('one').addClass('two')
      if ($(this).attr('data-title') === role1) role1Score++
      else role2Score++
      $('#text-role1').text(`${role1Score} / ${role1Num}`)
      $('#text-role2').text(`${role2Score} / ${role2Num}`)
      score = role1Score + role2Score
      $('#text-score').text(score)
    })

  </script>
</body>

</html>